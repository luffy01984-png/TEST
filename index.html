<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>Runner Mobile</title>

<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #f7f7f7;
    height: 100%;
    width: 100%;
    overflow: hidden;
    touch-action: none;
    font-family: system-ui, Arial;
  }

  /* CANVAS PLEIN Ã‰CRAN */
  #game {
    position: absolute;
    top: 0;
    left: 0;
    width: 100vw;
    height: 50vh; /* hauteur idÃ©ale smartphone */
    background: #e8e8e8;
  }

  /* BOUTONS UI */
  .ui {
    position: absolute;
    bottom: 12px;
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 12px;
  }

  .ui button {
    padding: 12px 20px;
    font-size: 18px;
    border-radius: 10px;
    border: 1px solid #ddd;
    background: white;
    cursor: pointer;
  }
</style>
</head>

<body>

<canvas id="game" width="800" height="200"></canvas>

<div class="ui">
  <button id="startBtn">DÃ©marrer</button>
  <button id="muteBtn">ðŸ”Š</button>
  <button id="resetBtn">Reset</button>
</div>

<script>
/* ------------------ CONFIG ------------------ */

/* â–º Ton image transparente */
const playerImgUrl = "https://raw.githubusercontent.com/luffy01984-png/TEST/main/chris.jpg";

/* Dimensions logiques du jeu */
const CANVAS_W = 800, CANVAS_H = 200;

/* Joueur plus grand */
const PLAYER_W = 90;
const PLAYER_H = 90;

const GROUND_Y = 160;
const GRAVITY = 0.9;
const JUMP_V = -15;

const OBSTACLE_MIN_GAP = 700;
const OBSTACLE_MAX_GAP = 1500;

const INITIAL_SPEED = 6;
const SPEED_SCALE = 0.12;

/* ------------------ CANVAS ------------------ */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = CANVAS_W;
canvas.height = CANVAS_H;

/* ------------------ UI ------------------ */
const startBtn = document.getElementById("startBtn");
const muteBtn = document.getElementById("muteBtn");
const resetBtn = document.getElementById("resetBtn");

let running = false;
let lastTime = 0;
let speed = INITIAL_SPEED;
let score = 0;
let highScore = parseInt(localStorage.getItem("runner_highscore") || "0", 10);
let soundsOn = true;

/* ------------------ PLAYER IMAGE ------------------ */
const playerImg = new Image();
playerImg.crossOrigin = "anonymous";
playerImg.src = playerImgUrl;
let playerReady = false;
playerImg.onload = () => playerReady = true;

/* ------------------ AUDIO ------------------ */
let audioCtx;
function beep(freq=500, dur=0.08, vol=0.2) {
  if (!soundsOn) return;
  try {
    if (!audioCtx) audioCtx = new AudioContext();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.frequency.value = freq;
    gain.gain.value = vol;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + dur);
  } catch(e){}
}

/* ------------------ ENTITÃ‰S ------------------ */
const player = {
  x: 80,
  y: GROUND_Y - PLAYER_H,
  w: PLAYER_W,
  h: PLAYER_H,
  vy: 0,
  onGround: true,

  jump() {
    if (this.onGround) {
      this.vy = JUMP_V;
      this.onGround = false;
      beep(900,0.08);
    }
  },

  update(dt) {
    this.vy += GRAVITY * dt;
    this.y += this.vy * dt;

    if (this.y >= GROUND_Y - this.h) {
      this.y = GROUND_Y - this.h;
      this.vy = 0;
      this.onGround = true;
    }
  },

  draw() {
    if (playerReady) {
      ctx.drawImage(playerImg, this.x, this.y, this.w, this.h);
    } else {
      ctx.fillStyle = "green";
      ctx.fillRect(this.x, this.y, this.w, this.h);
    }
  },

  box() {
    return {x:this.x, y:this.y, w:this.w, h:this.h};
  }
};

let obstacles = [];

function spawnObstacle() {
  const h = 20 + Math.random()*50;
  const w = 20 + Math.random()*40;

  obstacles.push({
    x: CANVAS_W + 20,
    y: GROUND_Y - h,
    w, h,
    passed: false,

    update(dt) {
      this.x -= speed * dt;
    },

    draw() {
      ctx.fillStyle = "#444";
      ctx.fillRect(this.x, this.y, this.w, this.h);
    },

    box() {
      return {x:this.x, y:this.y, w:this.w, h:this.h};
    }
  });
}

/* Collision simple */
function collide(a,b){
  return !(a.x+a.w<b.x || a.x>b.x+b.w || a.y+a.h<b.y || a.y>b.y+b.h);
}

/* ------------------ GAME LOOP ------------------ */
let spawnTimer = 0;
let spawnNext = 800;

function resetGame(){
  obstacles = [];
  speed = INITIAL_SPEED;
  player.y = GROUND_Y - PLAYER_H;
  player.vy = 0;
  score = 0;
  running = false;
  startBtn.textContent = "DÃ©marrer";
}

function loop(t) {
  if (!lastTime) lastTime = t;
  const dt = (t-lastTime)/16.666;
  lastTime = t;

  if (!running) {
    draw();
    return requestAnimationFrame(loop);
  }

  /* Update */
  player.update(dt);

  spawnTimer += t - lastTime + (dt*16.666);
  if (spawnTimer >= spawnNext) {
    spawnObstacle();
    spawnTimer = 0;
    spawnNext = OBSTACLE_MIN_GAP + Math.random()*(OBSTACLE_MAX_GAP-OBSTACLE_MIN_GAP);
  }

  for (let o of obstacles) o.update(dt);
  obstacles = obstacles.filter(o => o.x + o.w > -50);

  /* Scoring + speed */
  for (let o of obstacles) {
    if (!o.passed && o.x + o.w < player.x) {
      o.passed = true;
      score += 10;
      speed += SPEED_SCALE;
    }
    if (collide(player.box(), o.box())) {
      running = false;
      beep(200,0.3);
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("runner_highscore", highScore);
      }
      startBtn.textContent = "Rejouer";
    }
  }

  draw();
  requestAnimationFrame(loop);
}

/* ------------------ RENDER ------------------ */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "#efefef";
  ctx.fillRect(0, GROUND_Y, canvas.width, 40);

  for (let o of obstacles) o.draw();
  player.draw();

  ctx.fillStyle = "#222";
  ctx.font = "18px Arial";
  ctx.fillText("Score : " + score, 20, 30);
  ctx.fillText("High : " + highScore, 20, 55);
}

/* ------------------ INPUT ------------------ */
window.addEventListener("keydown", e => {
  if (e.code === "Space" || e.code === "ArrowUp") {
    if (!running) startGame();
    player.jump();
  }
});

canvas.addEventListener("touchstart", () => {
  if (!running) startGame();
  player.jump();
});

startBtn.addEventListener("click", () => {
  if (!running) startGame();
});

muteBtn.addEventListener("click", () => {
  soundsOn = !soundsOn;
  muteBtn.textContent = soundsOn ? "ðŸ”Š" : "ðŸ”‡";
});

resetBtn.addEventListener("click", () => {
  localStorage.setItem("runner_highscore","0");
  highScore = 0;
  alert("Score rÃ©initialisÃ© !");
});

/* ------------------ START ------------------ */
function startGame(){
  resetGame();
  running = true;
  lastTime = 0;
  startBtn.textContent = "En jeu...";
  requestAnimationFrame(loop);
}

draw();
</script>

</body>
</html>
